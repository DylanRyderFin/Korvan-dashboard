<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fag Hub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #121212;
      color: white;
    }
    .login-container, .dashboard, #pageBuilder {
      display: none;
    }
    .login-container.active, .dashboard.active, #pageBuilder.active {
      display: block;
    }
    .login-box {
      max-width: 300px;
      margin: 100px auto;
      padding: 20px;
      background: #1e1e1e;
      border: 2px solid #ff69b4;
      border-radius: 10px;
      text-align: center;
    }
    input {
      padding: 8px;
      margin: 5px 0;
      width: 90%;
    }
    button {
      padding: 8px 12px;
      background: #ff69b4;
      border: none;
      color: white;
      cursor: pointer;
      margin-top: 10px;
    }
    .sidebar {
      position: fixed;
      width: 200px;
      height: 100%;
      background: #1e1e1e;
      top: 0;
      left: 0;
      padding-top: 20px;
      border-right: 2px solid #ff69b4;
    }
    .sidebar a {
      display: block;
      padding: 10px;
      color: white;
      text-decoration: none;
    }
    .sidebar a:hover {
      background: #333;
    }
    .main-content {
      margin-left: 210px;
      padding: 20px;
    }
    .section {
      border: 1px dashed #ff69b4;
      padding: 10px;
      margin-bottom: 10px;
      background: #1f1f1f;
    }
    #settingsPopup {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      background: #1e1e1e;
      padding: 20px;
      border: 2px solid #ff69b4;
      z-index: 999;
      width: 300px;
    }
    #settingsPopup textarea {
      width: 100%;
      height: 100px;
      background: #111;
      color: white;
      margin-bottom: 10px;
    }
    #chatLog, #chatGPTLog {
      background:#222;
      height:100px;
      overflow-y:auto;
      margin-bottom:5px;
      padding: 5px;
      white-space: pre-wrap;
      border-radius: 4px;
    }
    #chatInput, #chatGPTInput {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      background: #111;
      color: white;
      border: none;
      border-radius: 4px;
    }
    #chatSection, #chatGPTSection {
      margin-top: 15px;
    }
  </style>
</head>
<body>

<div class="login-container active" id="loginContainer">
  <div class="login-box">
    <h2>Login to Fag Hub</h2>
    <input type="text" id="username" placeholder="Username"/><br/>
    <input type="password" id="password" placeholder="Password"/><br/>
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red;"></p>
  </div>
</div>

<div class="dashboard" id="dashboard">
  <div class="sidebar">
    <a href="#" onclick="showPage('dashboardView')">Dashboard</a>
    <a href="#" onclick="showSettings()">Settings</a>
    <a href="#" onclick="showPageBuilder()" id="pageBuilderLink" style="display:none">Page Builder</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>
  <div class="main-content">
    <div id="dashboardView">
      <h1>Welcome, <span id="displayName"></span></h1>
      <p id="dailyMessage"></p>
      <div class="section" id="debtSection">Debt Price: <span id="debtAmount">$1000</span></div>
      <div class="section" id="profileSection">Profile: <span id="profileInfo">Obedient sub with growing debt</span></div>

      <!-- Custom AI Chatbox for all users -->
      <div class="section" id="chatSection" style="display:none;">
        <h3>Custom AI Chatbox</h3>
        <div id="chatLog"></div>
        <input type="text" id="chatInput" placeholder="Say something to your dom..." onkeypress="if(event.key==='Enter')sendChat()" />
      </div>

      <!-- ChatGPT Box only for Dylan -->
      <div class="section" id="chatGPTSection" style="display:none;">
        <h3>ChatGPT</h3>
        <div id="chatGPTLog"></div>
        <input type="text" id="chatGPTInput" placeholder="Ask ChatGPT..." onkeypress="if(event.key==='Enter')sendChatGPT()" />
      </div>
    </div>

    <div id="pageBuilder" style="display:none;">
      <h2>Page Builder</h2>
      <div id="editableSections">
        <div class="section" contenteditable="true">Editable Section 1</div>
        <div class="section" contenteditable="true">Editable Section 2</div>
      </div>
      <button onclick="addSection()">Add Section</button>
      <button onclick="saveChanges('all')">Save to All</button>
      <button onclick="saveChanges('current')">Save to My Account</button>
    </div>
  </div>
</div>

<div id="settingsPopup">
  <h3>Edit Settings</h3>
  <!-- Debt editing removed -->
  <!-- Only profile and password -->
  <textarea id="editProfile" placeholder="Edit profile..."></textarea>
  <input type="password" id="editPassword" placeholder="Change password (leave blank to keep)" />
  <button onclick="saveSettings()">Save</button>
  <button onclick="closeSettings()">Close</button>
</div>

<script>
  const users = {
    "Alpha Dylan": { password: "alpha", role: "alpha" },
    "Andrew": { password: "sub", role: "sub" }
  };

  let currentUser = null;

  // LOGIN FUNCTION
  function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    if (users[username] && users[username].password === password) {
      currentUser = { username, role: users[username].role };
      document.getElementById('loginContainer').classList.remove('active');
      document.getElementById('dashboard').classList.add('active');
      document.getElementById('displayName').innerText = username;
      showDailyMessage();

      // Show chatbox (custom AI) for all users
      document.getElementById('chatSection').style.display = 'block';

      // Load custom chat for current user
      loadChat();

      // Show ChatGPT and Page Builder only for Dylan
      if (currentUser.username === 'Alpha Dylan') {
        document.getElementById('chatGPTSection').style.display = 'block';
        document.getElementById('pageBuilderLink').style.display = 'block';
      } else {
        document.getElementById('chatGPTSection').style.display = 'none';
        document.getElementById('pageBuilderLink').style.display = 'none';
      }

      showPage('dashboardView');
      clearLoginError();
    } else {
      document.getElementById('loginError').innerText = "Invalid credentials";
    }
  }

  function clearLoginError() {
    document.getElementById('loginError').innerText = '';
  }

  // LOGOUT FUNCTION
  function logout() {
    currentUser = null;
    document.getElementById('loginContainer').classList.add('active');
    document.getElementById('dashboard').classList.remove('active');
    // Reset chatboxes
    document.getElementById('chatLog').innerHTML = '';
    document.getElementById('chatGPTLog').innerHTML = '';
    document.getElementById('chatInput').value = '';
    document.getElementById('chatGPTInput').value = '';
  }

  // DAILY MESSAGE
  function showDailyMessage() {
    const messages = [
      "You exist to serve, nothing more.",
      "Your worth is defined by your obedience.",
      "Today, youâ€™ll prove your devotion again."
    ];
    document.getElementById('dailyMessage').innerText = messages[Math.floor(Math.random() * messages.length)];
  }

  // SHOW PAGE FUNCTION
  function showPage(id) {
    // Hide all top-level views
    document.getElementById('dashboardView').style.display = 'none';
    document.getElementById('pageBuilder').style.display = 'none';

    document.getElementById(id).style.display = 'block';
  }

  // SETTINGS POPUP
  function showSettings() {
    if (!currentUser) return;
    document.getElementById('settingsPopup').style.display = 'block';
    // Load current profile
    document.getElementById('editProfile').value = localStorage.getItem(`profile_${currentUser.username}`) || 'Obedient sub with growing debt';
    // Clear password input
    document.getElementById('editPassword').value = '';
  }
  function closeSettings() {
    document.getElementById('settingsPopup').style.display = 'none';
  }
  function saveSettings() {
    if (!currentUser) return;
    const profile = document.getElementById('editProfile').value;
    const newPass = document.getElementById('editPassword').value;

    localStorage.setItem(`profile_${currentUser.username}`, profile);
    document.getElementById('profileInfo').innerText = profile;

    if (newPass.trim()) {
      users[currentUser.username].password = newPass;
      alert('Password changed.');
    }
    closeSettings();
  }

  // PAGE BUILDER
  function showPageBuilder() {
    if (currentUser && currentUser.username === 'Alpha Dylan') {
      showPage('pageBuilder');
      loadPageBuilder();
    }
  }
  function addSection() {
    const container = document.getElementById('editableSections');
    const newSection = document.createElement('div');
    newSection.classList.add('section');
    newSection.contentEditable = "true";
    newSection.textContent = 'New editable section';
    container.appendChild(newSection);
  }
  function saveChanges(scope) {
    const container = document.getElementById('editableSections');
    const sections = container.querySelectorAll('.section');
    const contents = [];
    sections.forEach(sec => contents.push(sec.innerHTML));

    if (scope === 'all') {
      localStorage.setItem('pageBuilder_all', JSON.stringify(contents));
      alert('Saved changes for ALL users');
    } else if (scope === 'current' && currentUser) {
      localStorage.setItem(`pageBuilder_${currentUser.username}`, JSON.stringify(contents));
      alert('Saved changes for YOUR account');
    }
  }
  function loadPageBuilder() {
    let contents = null;
    if (localStorage.getItem(`pageBuilder_${currentUser.username}`)) {
      contents = JSON.parse(localStorage.getItem(`pageBuilder_${currentUser.username}`));
    } else if (localStorage.getItem('pageBuilder_all')) {
      contents = JSON.parse(localStorage.getItem('pageBuilder_all'));
    }
    if (contents) {
      const container = document.getElementById('editableSections');
      container.innerHTML = '';
      contents.forEach(html => {
        const div = document.createElement('div');
        div.classList.add('section');
        div.contentEditable = "true";
        div.innerHTML = html;
        container.appendChild(div);
      });
    }
  }

  // CUSTOM AI CHATBOX (per-user chat history)
  function loadChat() {
    if (!currentUser) return;
    const log = document.getElementById('chatLog');
    log.innerHTML = '';
    const history = localStorage.getItem(`chat_${currentUser.username}`);
    if (history) {
      const messages = JSON.parse(history);
      messages.forEach(msg => {
        const div = document.createElement('div');
        div.textContent = msg;
        log.appendChild(div);
      });
      log.scrollTop = log.scrollHeight;
    }
  }
  function saveChatMessage(message) {
    if (!currentUser) return;
    const key = `chat_${currentUser.username}`;
    let history = localStorage.getItem(key);
    let messages = history ? JSON.parse(history) : [];
    messages.push(message);
    localStorage.setItem(key, JSON.stringify(messages));
  }
  function sendChat() {
    const input = document.getElementById('chatInput');
    if (!input.value.trim()) return;
    const log = document.getElementById('chatLog');
    const userMsg = `You: ${input.value}`;
    const userDiv = document.createElement('div');
    userDiv.textContent = userMsg;
    log.appendChild(userDiv);
    log.scrollTop = log.scrollHeight;

    saveChatMessage(userMsg);

    const userInput = input.value;
    input.value = '';

    // Fake AI reply after delay
    setTimeout(() => {
      const replyText = "Custom AI: I'm here for you.";
      const replyDiv = document.createElement('div');
      replyDiv.textContent = replyText;
      log.appendChild(replyDiv);
      log.scrollTop = log.scrollHeight;

      saveChatMessage(replyText);
    }, 1000);
  }

  // CHATGPT BOX (Dylan only, simple echo for demo)
  function sendChatGPT() {
    const input = document.getElementById('chatGPTInput');
    if (!input.value.trim()) return;
    const log = document.getElementById('chatGPTLog');
    const userMsg = `You: ${input.value}`;
    const userDiv = document.createElement('div');
    userDiv.textContent = userMsg;
    log.appendChild(userDiv);
    log.scrollTop = log.scrollHeight;

    // Simulate ChatGPT reply after delay
    setTimeout(() => {
      const replyText = "ChatGPT: Sorry, no backend yet.";
      const replyDiv = document.createElement('div');
      replyDiv.textContent = replyText;
      log.appendChild(replyDiv);
      log.scrollTop = log.scrollHeight;
    }, 1200);

    input.value = '';
  }

</script>

</body>
</html>
